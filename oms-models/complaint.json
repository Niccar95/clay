{
  "name": "complaint",
  "localized_name": "Reklamation",
  "description": "En reklamation på hel eller eller del av order",
  "mixin": ["default_actions", "linked_fields"],
  "belongs_to": ["order"],
  "defaultSort": "-complaintNumber",
  "defaultSimilaritySortField": "complaintNumber",
  "children": {
    "complaintRows": {
      "tab": "Detaljer",
      "type": "array",
      "localized_name": "Reklamationsrader",
      "name": "complaintRows",
      "display_if": "entity.complaintType === 'missingArticles' || entity.complaintType === 'wrongArticles' || entity.complaintType === 'wrongPrices' || entity.complaintType === 'articlesBrokenInTransport' || entity.complaintType === 'articleDoesNotMeetQualityExpectations'",
      "mixin": ["linked_fields"],
      "belongs_to": ["article"],
      "fields": {
        "id": {
          "type": "string",
          "required": false,
          "primary": true,
          "description": "primary key",
          "localized_name": "Identitet"
        },
        "article": {
          "tab": "Detaljer",
          "type": "relation",
          "relation": "article",
          "localized_name": "Artikel",
          "required": false,
          "is_available_in_reference": true,
          "readonly_in_ui": true
        },
        "quantity": {
          "tab": "Detaljer",
          "type": "number",
          "display_if": "parentEntity.complaintType !== 'wrongPrices'",
          "localized_name": "Antal i styck",
          "required": false,
          "is_available_in_reference": true
        },
        "discount": {
          "tab": "Detaljer",
          "type": "number",
          "step": 0.01,
          "localized_name": "Procentrabatt",
          "required": false,
          "is_available_in_reference": true
        },
        "expectedPrice": {
          "tab": "Detaljer",
          "type": "number",
          "display_if": "parentEntity.complaintType === 'wrongPrices'",
          "step": 0.01,
          "localized_name": "Förväntat pris per styck",
          "required": false,
          "is_available_in_reference": true
        }
      }
    },
    "complaintImages": {
      "tab": "Detaljer",
      "type": "array",
      "localized_name": "Bilder",
      "name": "complaintImages",
      "mixin": ["linked_fields"],
      "fields": {
        "id": {
          "type": "string",
          "required": false,
          "primary": true,
          "description": "primary key",
          "localized_name": "Identitet"
        },
        "image": {
          "tab": "Detaljer",
          "type": "S3image",
          "localized_name": "Bild",
          "description": "bild på skadan",
          "required_in_ui": false,
          "is_available_in_reference": true
        }
      }
    }
  },
  "fields": {
    "id": {
      "type": "string",
      "primary": true,
      "description": "primary key",
      "localized_name": "Identitet"
    },
    "complaintNumber": {
      "tab": "Detaljer",
      "fuzzy_searchable": true,
      "type": "number",
      "localized_name": "Reklamationsnummer",
      "readonly": true,
      "is_available_in_reference": true,
      "unique": true
    },
    "complaintDate": {
      "tab": "Detaljer",
      "type": "date",
      "localized_name": "Reklamationsdatum",
      "required": false,
      "is_available_in_reference": true
    },
    "resolution": {
      "tab": "Detaljer",
      "type": "text",
      "description": "",
      "localized_name": "Lösning",
      "required": false,
      "is_available_in_reference": false
    },
    "order": {
      "tab": "Detaljer",
      "type": "relation",
      "relation": "order",
      "localized_name": "Order",
      "readonly_in_ui": true,
      "is_available_in_reference": true,
      "required": true
    },
    "cancelled": {
      "tab": "Detaljer",
      "type": "boolean",
      "default": false,
      "localized_name": "Makulerad",
      "required": false,
      "is_available_in_reference": true
    },
    "contactName": {
      "tab": "Detaljer",
      "type": "string",
      "localized_name": "Kontaktperson",
      "required": false,
      "is_available_in_reference": true
    },
    "contactPhone": {
      "tab": "Detaljer",
      "type": "string",
      "localized_name": "Telefonnummer",
      "max_length": 50,
      "is_available_in_reference": true
    },
    "contactEmail": {
      "tab": "Detaljer",
      "type": "email",
      "localized_name": "E-post",
      "is_available_in_reference": true
    },
    "complaintType": {
      "tab": "Detaljer",
      "type": "string",
      "max_length": 255,
      "restrictedValues": [
        {
          "value": "customerGotWrongOrder",
          "label": "Fel order levererades"
        },
        {
          "value": "wrongArticles",
          "label": "Fel artiklar levererades"
        },
        {
          "value": "wrongPrices",
          "label": "Fel pris"
        },
        {
          "value": "missingArticles",
          "label": "Saknas artiklar på order"
        },
        {
          "value": "articlesBrokenInTransport",
          "label": "Artiklar gick sönder i leverans"
        },
        {
          "value": "articleDoesNotMeetQualityExpectations",
          "label": "Artikeln tillfredställer inte kvalitetskrav"
        },
        {
          "value": "lostInDelivery",
          "label": "Leveransen är försvunnen"
        },
        {
          "value": "cancelledDueToLateHandling",
          "label": "Ordern blev så sen så att den inte längre är aktuell"
        },
        {
          "value": "other",
          "label": "Annat"
        }
      ],
      "description": "What has happened?",
      "localized_name": "Ärendetyp",
      "is_available_in_reference": true,
      "required": true
    },
    "resolutionType": {
      "tab": "Detaljer",
      "type": "enum",
      "values": [
        {
          "key": "credit",
          "label": "Krediterad - vi får inte tillbaka artiklarna"
        },
        {
          "key": "return",
          "label": "Krediterad - retur bokad"
        },
        {
          "key": "customerPayed",
          "label": "Kunden köper extra produkterna"
        },
        {
          "key": "other",
          "label": "Annat - manuell hantering av ekonomi"
        },
        {
          "key": "none",
          "label": "Ingen åtgärd"
        }
      ],
      "description": "",
      "localized_name": "Åtgärdstyp",
      "default": "'none'",
      "required": false,
      "is_available_in_reference": true
    },
    "description": {
      "tab": "Detaljer",
      "type": "text",
      "description": "",
      "localized_name": "Beskrivning",
      "required": false,
      "is_available_in_reference": false
    },
    "assignedResponsibility": {
      "tab": "Detaljer",
      "type": "enum",
      "values": [
        {
          "key": "warehouse",
          "label": "Vinden - faktura sker direkt"
        },
        {
          "key": "supplier",
          "label": "Leverantör - ersättning hanteras i avräkning"
        },
        {
          "key": "flaivy",
          "label": "Flaivy"
        },
        {
          "key": "none",
          "label": "Ingen"
        }
      ],
      "description": "",
      "localized_name": "Ersättningsansvarig",
      "default": "'none'",
      "required": false,
      "is_available_in_reference": true
    },
    "resolutionDate": {
      "tab": "Detaljer",
      "type": "date",
      "localized_name": "Avslutad",
      "required": false,
      "is_available_in_reference": true
    },
    "complaintState": {
      "tab": "Detaljer",
      "type": "enum",
      "values": [
        {
          "key": "received",
          "label": "Mottagen"
        },
        {
          "key": "inReview",
          "label": "Granskas"
        },
        {
          "key": "resolved",
          "label": "Klar"
        }
      ],
      "description": "",
      "localized_name": "Status",
      "default": "'received'",
      "required": false,
      "is_available_in_reference": true
    },
    "customerAdjustmentInvoice": {
      "tab": "Detaljer",
      "type": "relation",
      "relation": "invoice",
      "localized_name": "Kreditfaktura mot kund",
      "is_available_in_reference": true,
      "readonly_in_ui": true
    },
    "freightClaimsInvoice": {
      "tab": "Detaljer",
      "type": "relation",
      "relation": "invoice",
      "localized_name": "Faktura mot vinden för ersättning",
      "is_available_in_reference": true,
      "readonly_in_ui": true
    }
  },
  "events": {
    "COMPLAINT_UPDATED": {
      "localized_name": "Reklamation uppdaterad",
      "should_inform_service": true,
      "should_inform_user": true
    },
    "COMPLAINT_CREATED": {
      "localized_name": "Reklamation skapad",
      "should_inform_service": true,
      "should_inform_user": true
    },
    "COMPLAINT_CANCELLED": {
      "localized_name": "Reklamation makulerad",
      "should_inform_service": true,
      "should_inform_user": true
    },
    "COMPLAINT_PLACED": {
      "localized_name": "Reklamation lagd",
      "should_inform_service": true,
      "should_inform_user": true
    },
    "COMPLAINT_REVIEW_STARTED": {
      "localized_name": "Reklamation granskning startad",
      "should_inform_service": true,
      "should_inform_user": true
    },
    "COMPLAINT_RESOLVED": {
      "localized_name": "Reklamation granskad",
      "should_inform_service": true,
      "should_inform_user": true
    }
  },
  "actions": {
    "writeComplaint": {
      "name": "writeComplaint",
      "requiredRole": [
        "super",
        "customerSubUnitAdmin",
        "customerSubUnitPurchaserManager",
        "customerSubUnitEconomy",
        "customerSubUnitPurchaser"
      ],
      "availableForCustomer": true,
      "localized_name": "Skapa reklamation",
      "canCreate": true,
      "parameters": {
        "includeParameters": "*",
        "excludeParameters": [
          "complaintState",
          "complaintDate",
          "resolution",
          "resolutionDate",
          "resolutionType",
          "assignedResponsibility",
          "cancelled",
          "freightClaimsInvoice",
          "alcTaxAdjustmentInvoice",
          "customerAdjustmentInvoice"
        ]
      }
    },
    "beginReview": {
      "name": "beginReview",
      "requiredRole": ["super"],
      "localized_name": "Granska",
      "parameters": {
        "includeParameters": ["id"]
      }
    },
    "comment": {
      "name": "comment",
      "requiredRole": ["super"],
      "localized_name": "Kommentera",
      "parameters": {
        "includeParameters": ["id", "description"]
      }
    },
    "resolveComplaint": {
      "name": "resolveComplaint",
      "requiredRole": ["super"],
      "localized_name": "Klarmarkera",
      "parameters": {
        "includeParameters": [
          "id",
          "resolution",
          "resolutionType",
          "assignedResponsibility"
        ],
        "runAutomation": {
          "tab": "Detaljer",
          "type": "boolean",
          "required": true,
          "localized_name": "Vill du skapa fakturor och mail automatiskt?"
        }
      }
    },
    "cancel": {
      "name": "cancel",
      "requiredRole": ["super"],
      "color": "danger",
      "localized_name": "Makulera",
      "conditional": "Det går inte att ångra en makulering. Vill du fortsätta?",
      "description": "Makulerar",
      "parameters": {
        "includeParameters": ["id"]
      }
    },
    "ensureInvariants": {
      "name": "ensureInvariants",
      "requiredRole": ["super"],
      "localized_name": "Räkna om totaler",
      "description": "Stöd action för att kontrollera avräkningsrader",
      "parameters": {
        "id": {
          "linked_field": "id"
        }
      }
    }
  }
}
